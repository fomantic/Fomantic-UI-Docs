!function(t){t.address=function(){function e(t){return"function"==typeof t&&"number"!=typeof t.nodeType}var r,n,a,i,s=function(e){var r=t.extend(t.Event(e),function(){for(var e={},r=t.address.parameterNames(),n=0,a=r.length;n<a;n++)e[r[n]]=t.address.parameter(r[n]);return{value:t.address.value(),path:t.address.path(),pathNames:t.address.pathNames(),parameterNames:r,parameters:e,queryString:t.address.queryString()}}.call(t.address));return t(t.address).trigger(r),r},o=function(t){return Array.prototype.slice.call(t)},c=function(e,r,n){return t().on.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},u=function(e,r){return t().off.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},d=function(){return W.pushState&&q.state!==r},l=function(){return("/"+_.pathname.replace(new RegExp(q.state),"")+_.search+(p()?"#"+p():"")).replace(P,"/")},p=function(){var t=_.href.indexOf("#");return-1!=t?_.href.substr(t+1):""},h=function(){return d()?l():p()},f=function(t){return t=t.toString(),(q.strict&&"/"!=t.substr(0,1)?"/":"")+t},v=function(t,e){return parseInt(t.css(e),10)},g=function(){if(!H){var t=h();decodeURI(Y)!=decodeURI(t)&&(L&&$<7?_.reload():(L&&!K&&q.history&&B(w,50),Y=t,m(j)))}},m=function(t){return B(y,10),s(T).isDefaultPrevented()||s(t?U:R).isDefaultPrevented()},y=function(){if("null"!==q.tracker&&q.tracker!==k){var n=e(q.tracker)?q.tracker:C[q.tracker],a=(_.pathname+_.search+(t.address&&!d()?t.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");e(n)?n(a):e(C.urchinTracker)?C.urchinTracker(a):C.pageTracker!==r&&e(C.pageTracker._trackPageview)?C.pageTracker._trackPageview(a):C._gaq!==r&&e(C._gaq.push)&&C._gaq.push(["_trackPageview",decodeURI(a)])}},w=function(){var t="javascript:"+j+";document.open();document.writeln('<html><head><title>"+M.title.replace(/\'/g,"\\'")+"</title><script>var "+E+' = "'+encodeURIComponent(h()).replace(/\'/g,"\\'")+(M.domain!=_.hostname?'";document.domain="'+M.domain:"")+"\";<\/script></head></html>');document.close();";$<7?n.src=t:n.contentWindow.location.replace(t)},b=function(){if(F&&-1!=Q){var t,e,r=F.substr(Q+1).split("&");for(t=0;t<r.length;t++)e=r[t].split("="),/^(autoUpdate|history|strict|wrap)$/.test(e[0])&&(q[e[0]]=isNaN(e[1])?/^(true|yes)$/i.test(e[1]):0!==parseInt(e[1],10)),/^(state|tracker)$/.test(e[0])&&(q[e[0]]=e[1]);F=k}Y=h()},x=function(){if(!J){if(J=A,b(),t('a[rel*="address:"]').address(),q.wrap){var e=t("body");t("body > *").wrapAll('<div style="padding:'+(v(e,"marginTop")+v(e,"paddingTop"))+"px "+(v(e,"marginRight")+v(e,"paddingRight"))+"px "+(v(e,"marginBottom")+v(e,"paddingBottom"))+"px "+(v(e,"marginLeft")+v(e,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+E+'" style="height:100%;overflow:auto;position:relative;'+(O&&!window.statusbar.visible?"resize:both;":"")+'" />');t("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),O&&t('<style type="text/css" />').appendTo("head").text("#"+E+"::-webkit-resizer { background-color: #fff; }")}if(L&&!K){var a=M.getElementsByTagName("frameset")[0];(n=M.createElement((a?"":"i")+"frame")).src="javascript:"+j,a?(a.insertAdjacentElement("beforeEnd",n),a[a.cols?"cols":"rows"]+=",0",n.noResize=A,n.frameBorder=n.frameSpacing=0):(n.style.display="none",n.style.width=n.style.height=0,n.tabIndex=-1,M.body.insertAdjacentElement("afterBegin",n)),B((function(){t(n).on("load",(function(){var t=n.contentWindow;(Y=t[E]!==r?t[E]:"")!=h()&&(m(j),_.hash=Y)})),n.contentWindow[E]===r&&w()}),50)}B((function(){s("init"),m(j)}),1),d()||(L&&$>7||!L&&K?C.addEventListener?C.addEventListener(S,g,j):C.attachEvent&&C.attachEvent("on"+S,g):z(g,50)),"state"in window.history&&t(window).trigger("popstate")}},k=null,E="jQueryAddress",S="hashchange",I="init",T="change",U="internalChange",R="externalChange",A=!0,j=!1,q={autoUpdate:A,history:A,strict:A,wrap:j},N=(a={},(i=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(navigator.userAgent)).browser&&(a[i.browser]=!0,a.version=i.version),a.chrome?a.webkit=!0:a.webkit&&(a.safari=!0),a),$=parseFloat(N.version),O=N.webkit||N.safari,L=!t.support.opacity,C=function(){try{return top.document!==r&&top.document.title!==r?top:window}catch(t){return window}}(),M=C.document,W=C.history,_=C.location,z=setInterval,B=setTimeout,P=/\/{2,9}/g,D=navigator.userAgent,K="on"+S in C,F=t("script:last").attr("src"),Q=F?F.indexOf("?"):-1,G=M.title,H=j,J=j,V=A,X=j,Y=h();if(L){$=parseFloat(D.substr(D.indexOf("MSIE")+4)),M.documentMode&&M.documentMode!=$&&($=8!=M.documentMode?7:8);var Z=M.onpropertychange;M.onpropertychange=function(){Z&&Z.call(M),M.title!=G&&-1!=M.title.indexOf("#"+h())&&(M.title=G)}}if(W.navigationMode&&(W.navigationMode="compatible"),"complete"==document.readyState)var tt=setInterval((function(){t.address&&(x(),clearInterval(tt))}),50);else b(),t(x);return t(window).on("popstate",(function(){decodeURI(Y)!=decodeURI(h())&&(Y=h(),m(j))})).on("unload",(function(){C.removeEventListener?C.removeEventListener(S,g,j):C.detachEvent&&C.detachEvent("on"+S,g)})),{bind:function(t,e,r){return c.apply(this,o(arguments))},unbind:function(t,e){return u.apply(this,o(arguments))},init:function(t,e){return c.apply(this,[I].concat(o(arguments)))},change:function(t,e){return c.apply(this,[T].concat(o(arguments)))},internalChange:function(t,e){return c.apply(this,[U].concat(o(arguments)))},externalChange:function(t,e){return c.apply(this,[R].concat(o(arguments)))},baseURL:function(){var t=_.href;return-1!=t.indexOf("#")&&(t=t.substr(0,t.indexOf("#"))),/\/$/.test(t)&&(t=t.substr(0,t.length-1)),t},autoUpdate:function(t){return t!==r?(q.autoUpdate=t,this):q.autoUpdate},history:function(t){return t!==r?(q.history=t,this):q.history},state:function(t){if(t!==r){q.state=t;var e=l();return q.state!==r&&(W.pushState?"/#/"==e.substr(0,3)&&_.replace(q.state.replace(/^\/$/,"")+e.substr(2)):"/"!=e&&e.replace(/^\/#/,"")!=p()&&B((function(){_.replace(q.state.replace(/^\/$/,"")+"/#"+e)}),1)),this}return q.state},strict:function(t){return t!==r?(q.strict=t,this):q.strict},tracker:function(t){return t!==r?(q.tracker=t,this):q.tracker},wrap:function(t){return t!==r?(q.wrap=t,this):q.wrap},update:function(){return X=A,this.value(Y),X=j,this},title:function(t){return t!==r?(B((function(){G=M.title=t,V&&n&&n.contentWindow&&n.contentWindow.document&&(n.contentWindow.document.title=t,V=j)}),50),this):M.title},value:function(t){if(t!==r){if("/"==(t=f(t))&&(t=""),Y==t&&!X)return;if(Y=t,q.autoUpdate||X){if(m(A))return this;d()?W[q.history?"pushState":"replaceState"]({},"",q.state.replace(/\/$/,"")+(""===Y?"/":Y)):(H=A,(O||Y!=h())&&(q.history?_.hash="#"+Y:_.replace("#"+Y)),L&&!K&&q.history&&B(w,50),O?B((function(){H=j}),1):H=j)}return this}return f(Y)},path:function(t){if(t!==r){var e=this.queryString(),n=this.hash();return this.value(t+(e?"?"+e:"")+(n?"#"+n:"")),this}return f(Y).split("#")[0].split("?")[0]},pathNames:function(){var t=this.path(),e=t.replace(P,"/").split("/");return"/"!=t.substr(0,1)&&0!==t.length||e.splice(0,1),"/"==t.substr(t.length-1,1)&&e.splice(e.length-1,1),e},queryString:function(t){if(t!==r){var e=this.hash();return this.value(this.path()+(t?"?"+t:"")+(e?"#"+e:"")),this}var n=Y.split("?");return n.slice(1,n.length).join("?").split("#")[0]},parameter:function(e,n,a){var i,s;if(n!==r){var o=this.parameterNames();for(s=[],n=n===r||n===k?"":n.toString(),i=0;i<o.length;i++){var c=o[i],u=this.parameter(c);"string"==typeof u&&(u=[u]),c==e&&(u=n===k||""===n?[]:a?u.concat([n]):[n]);for(var d=0;d<u.length;d++)s.push(c+"="+u[d])}return-1==t.inArray(e,o)&&n!==k&&""!==n&&s.push(e+"="+n),this.queryString(s.join("&")),this}if(n=this.queryString()){var l=[];for(s=n.split("&"),i=0;i<s.length;i++){var p=s[i].split("=");p[0]==e&&l.push(p.slice(1).join("="))}if(0!==l.length)return 1!=l.length?l:l[0]}},parameterNames:function(){var e=this.queryString(),r=[];if(e&&-1!=e.indexOf("="))for(var n=e.split("&"),a=0;a<n.length;a++){var i=n[a].split("=")[0];-1==t.inArray(i,r)&&r.push(i)}return r},hash:function(t){if(t!==r)return this.value(Y.split("#")[0]+(t?"#"+t:"")),this;var e=Y.split("#");return e.slice(1,e.length).join("#")}}}(),t.fn.address=function(e){return this.data("address")||this.on("click",(function(r){if(r.shiftKey||r.ctrlKey||r.metaKey||2==r.which)return!0;var n=r.currentTarget;if(t(n).is("a")){r.preventDefault();var a=e?e.call(n):/address:/.test(t(n).attr("rel"))?t(n).attr("rel").split("address:")[1].split(" ")[0]:void 0===t.address.state()||/^\/?$/.test(t.address.state())?t(n).attr("href").replace(/^(#\!?|\.)/,""):t(n).attr("href").replace(new RegExp("^(.*"+t.address.state()+"|\\.)"),"");t.address.value(a)}})).on("submit",(function(r){var n=r.currentTarget;if(t(n).is("form")){r.preventDefault();var a=t(n).attr("action"),i=e?e.call(n):(-1!=a.indexOf("?")?a.replace(/&$/,""):a+"?")+t(n).serialize();t.address.value(i)}})).data("address",!0),this}}(jQuery);
